<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>OpenLayers Zoomify Example</title>
    <script src="http://oldmapsonline.googlecode.com/svn/trunk/openlayers/OpenLayers.js"></script>
    <script type="text/javascript">

		var width = 7150;
		var height = 6225;
		var url = "http://almor.mzk.cz/moll/AA22/0103/";

        var map, zoomify;

        function init(){
	       /* First we initialize the zoomify pyramid (to get number of tiers) */
	        var zoomify = new OpenLayers.Layer.Zoomify( "Zoomify", url, 
		  		new OpenLayers.Size( width, height ) );
			zoomify.getURL = getURLcustom;
			//zoomify.tileSize = new OpenLayers.Size(512, 512);
			//zoomify.standardTileSize = 512;

	       /* Map with raster coordinates (pixels) from Zoomify image */
	        var options = {
	            controls: [],
	            maxExtent: new OpenLayers.Bounds(0, 0, width, height),
	            maxResolution: Math.pow(2, zoomify.numberOfTiers-1 ),
	            numZoomLevels: zoomify.numberOfTiers,
	            units: 'pixels'
	        };

	        map = new OpenLayers.Map("map", options);
	        map.addLayer(zoomify);

	        map.addControl(new OpenLayers.Control.MousePosition());
	        map.addControl(new OpenLayers.Control.PanZoomBar());
	        map.addControl(new OpenLayers.Control.MouseDefaults());
	        map.addControl(new OpenLayers.Control.KeyboardDefaults());

            map.setBaseLayer(zoomify);
	        map.zoomToMaxExtent();
        };

	    function getURLcustom (bounds) {
	        bounds = this.adjustBounds(bounds);
	        var res = this.map.getResolution();
			var size = this.getImageSize(bounds);
			var x = bounds.left + res*size.w/2;
			var y = this.maxExtent.top - bounds.top + res*size.h/2;
            var z = this.numZoomLevels - this.map.getZoom() - 1;
			//return "http://chart.apis.google.com/chart?chst=d_text_outline&chs="+size.w+"x"+size.h+"&chf=bg,s,00000055&chld=FFFFFF|16|h|000000|b|"+x+" "+y+"|"+z+"||("+bounds.left+"-"+bounds.right+")|("+bounds.top+"-"+bounds.bottom+")|||||____________________________";
			return "http://rumseysid.lunaimaging.com/mrsid/bin/image_jpeg.pl?client=Rumsey&image=SIDS/D0053/0890178.sid&x="+x+"&y="+y+"&width="+size.w+"&height="+size.h+"&level="+z;
	        var url = this.url;
	        if (url instanceof Array) {
	            url = this.selectUrl(path, url);
	        }
	        return url + path;
	    };

    </script>
  </head>
  <body onload="init()">
    <h2 id="title">Rumsey Map Collection Image Server</h2>
	<a href="http://www.davidrumsey.com/luna/servlet/detail/RUMSEY~8~1~21016~530108:Geneva--Geneve---with--View-of-Gene?sort=Pub_List_No_InitialSort&qvq=q:Geneve;sort:Pub_List_No_InitialSort;lc:RUMSEY~8~1&mi=0&trs=6">Original presentation</a>
    <div id="map" style="width:100%; height: 80%; border: 1px solid #aaa;"></div>
  </body>
</html>
